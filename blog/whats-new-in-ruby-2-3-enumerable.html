<!doctype html>
<html>
  <head>
    <title>What's new in Ruby 2.3 Enumerable - rossta.net</title>
<meta name="description" content="Ruby 2.3 introduced a couple new additions to the Enumerable API that provide some nice variations on existing methods" />
<meta name="keywords" content="Ruby" />
<meta name="site" content="rossta.net" />
<meta property="og:site_name" content="rossta.net" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="Ross Kaffenberger" />
<meta name="twitter:description" content="Ruby 2.3 introduced a couple new additions to the Enumerable API that provide some nice variations on existing methods" />
<meta name="twitter:image:src" content="https://rossta.net/assets/images/blog/stock/dark-brown-milk-candy-pexels-photo-a158f6e5.jpg" />
<meta name="twitter:title" content="What's new in Ruby 2.3 Enumerable" />
<meta property="og:description" content="Ruby 2.3 introduced a couple new additions to the Enumerable API that provide some nice variations on existing methods" />
<meta property="og:image" content="https://rossta.net/assets/images/blog/stock/dark-brown-milk-candy-pexels-photo-a158f6e5.jpg" />
<meta property="og:title" content="What's new in Ruby 2.3 Enumerable" />
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="mobile-web-app-capable" content="yes">

    <link rel="manifest" href="/manifest.json" />
    <link rel="apple-touch-icon"                 href="/apple-touch-icon.png" />
    <link rel="icon"             sizes="192x192" href="/touch-icon-192x192.png" />
    <link rel="icon"             sizes="36x36"   href="/touch-icon-36x36.png" />
    <link rel="icon"             sizes="48x48"   href="/touch-icon-48x48.png" />
    <link rel="icon"             sizes="72x72"   href="/touch-icon-72x72.png" />
    <link rel="icon"             sizes="96x96"   href="/touch-icon-96x96.png" />
    <link rel="icon"             sizes="144x144" href="/touch-icon-144x144.png" />
    <link rel="icon"                             href="/touch-icon-192x192.png" />

    <script type="text/javascript" src="//use.typekit.net/ned0mml.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    <link href="/assets/stylesheets/index.bundle-b473780b.css" rel="stylesheet" />
    <script src="/assets/javascripts/head.bundle-a0229364.js"></script>
    <link href="/assets/images/turtle-favicon.ico" rel="icon" type="image/ico" />
    <script src="//load.sumome.com/" data-sumo-site-id="4e5296d0b3f078761e3d795e6e9b33b6d80a1a1de31de31018515c9916e38ad7" async="async"></script>

  </head>
  <body id="application" class="typekit">
    <nav id="welcome-nav" class="top-bar" data-topbar>
  <ul class="title-area">
    <li class="name">
      <h1><a class="logo" href="/"><img src="/assets/images/turtle-logo-096698b6.svg" /><span>rossta.net</span></a></h1>
    </li>
    <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
  </ul>

  <section class="top-bar-section">
    <ul class="left">
      <li class="nav"><a href="/blog">blog</a></li>
      <li class="nav"><a href="/talks">talks</a></li>
      <li class="nav"><a href="/projects">projects</a></li>
      <li class="nav"><a href="/about">about</a></li>
      <li class="nav"><a href="/feed.xml">feed</a></li>
    </ul>
  </section>
</nav>

    <div class="row">
      <section id="main" role="main" class="large-12 small-12 columns">
          <section id="blog" class="margin-bottom double">
    <article class="post margin-bottom double">
      <header class="page-header with-summary">
  <h1>
    What's new in Ruby 2.3 Enumerable
  </h1>
    <h3>
      A closer look at Enumerable's grep_v and chunk_while
    </h3>
</header>

        <p><img src="/assets/images/blog/stock/dark-brown-milk-candy-pexels-photo-a158f6e5.jpg" /></p>

      <p>You may have heard <a href="https://www.ruby-lang.org/en/news/2015/12/25/ruby-2-3-0-released/">Ruby 2.3 dropped</a> on Christmas this past year. Two new <code>Enumerable</code> instance methods were added, <code>grep_v</code> and <code>chunk_while</code>, both of which are variations on other <code>Enumerable</code> methods. We&rsquo;ll dissect both here below.</p>

<h4>Triple Lindey</h4>

<p>Grep allows you to select members of a collection that match an expression. That expression is <code>some_object === item</code>.</p>

<p>What does &ldquo;triple equals&rdquo; do? Well, in Ruby, as in most languages, that answer is complicated. Since we can define this method however we want in our own classes, it can mean anything. But, most commonly, it is a loose way of asking whether an object belongs to a certain group:</p>

<blockquote>
<p>if <code>a</code> === <code>b</code>, then <code>b</code> is a subset of <code>a</code></p>
</blockquote>

<p>A few examples:</p>

<pre><code class="ruby">Symbol === :foo     # =&gt; true, :foo is a symbol
String === &quot;foo&quot;    # =&gt; true, &quot;foo&quot; is a string
Symbol === &quot;foo&quot;    # =&gt; false, &quot;foo&quot; is not a symbol
String === :foo     # =&gt; false, :foo is not a string

/foo/ === &quot;foobar&quot;  # =&gt; true, &quot;foobar&quot; matches /foo/
(1..10) === 2       # =&gt; true, 2 is in the range 1..10
</code></pre>

<p>We <em>could</em> use <code>select</code> to filter out items of a collection with the <code>===</code> like so:</p>

<pre><code class="ruby">1.upto(20).select { |i| (6..10) === i } # =&gt; [6, 7, 8, 9, 10]
</code></pre>

<p>But this is what <code>grep</code> is for:</p>

<pre><code class="ruby">1.upto(10).grep(6..8) # =&gt; [6, 7, 8]
</code></pre>

<p>So <code>grep</code> is like saying &ldquo;gimme all the items in the given set&rdquo;.</p>

<p>To get all the items <em>not</em> included, use <code>grep_v</code>:</p>

<pre><code class="ruby">1.upto(10).grep_v(6..8)
=&gt; [1, 2, 3, 4, 5, 9, 10]
</code></pre>

<p>It&rsquo;s probably most likely that you&rsquo;d use <code>grep</code> and <code>grep_v</code> with a regular expression, like
to select all the months that end in &ldquo;er&rdquo;:</p>

<pre><code class="ruby">MONTHS.grep(/er$/)
=&gt; [&quot;September&quot;, &quot;October&quot;, &quot;November&quot;, &quot;December&quot;]
</code></pre>

<p>Define <code>===</code> on any class or object to take advantage of filtering with <code>grep</code> and <code>grep_v</code> in other contexts.</p>

<h4>Chunking</h4>

<p>The <code>Enumerable</code> module provides several methods for enumerating adjacent
members of a collection, including <code>slice_when</code>, <code>slice_before</code>, <code>slice_after</code>,
<code>each_cons</code>, and, not surprisingly, <code>chunk</code>. Ruby 2.3 offers yet another
chunking method, <code>chunk_while</code>.</p>

<p>Before diving into <code>chunk_while</code>, let&rsquo;s look at its relatives, <code>chunk</code> and <code>slice_when</code>.</p>

<p>For the following examples, we&rsquo;ll enumerate over recurring events given by the
<code>Montrose</code> gem. Montrose provides an api to create recurrences as enumerators.</p>

<p>Here&rsquo;s a recurrence that will enumerate over every other Tuesday at noon.</p>

<pre><code class="ruby">require &quot;montrose&quot;

r = Montrose.every(2.weeks, on: :tuesday, at: &#39;12pm&#39;)

r.take(10).to_a
=&gt; [2016-02-02 12:00:00 -0500,
 2016-02-16 12:00:00 -0500,
 2016-03-01 12:00:00 -0500,
 2016-03-15 12:00:00 -0400,
 2016-03-29 12:00:00 -0400,
 2016-04-12 12:00:00 -0400,
 2016-04-26 12:00:00 -0400,
 2016-05-10 12:00:00 -0400,
 2016-05-24 12:00:00 -0400,
 2016-06-07 12:00:00 -0400]
</code></pre>

<p>For calendaring, it may be useful to split this array into chunks by month.</p>

<p>We could use <code>group_by</code> to return a hash of month numbers to Tuesday time
instances:</p>

<pre><code class="ruby">r.take(10).group_by(&amp;:month)
=&gt; {2=&gt;[2016-02-02 12:00:00 -0500, 2016-02-16 12:00:00 -0500],
 3=&gt;[2016-03-01 12:00:00 -0500, 2016-03-15 12:00:00 -0400, 2016-03-29 12:00:00 -0400],
 4=&gt;[2016-04-12 12:00:00 -0400, 2016-04-26 12:00:00 -0400],
 5=&gt;[2016-05-10 12:00:00 -0400, 2016-05-24 12:00:00 -0400],
 6=&gt;[2016-06-07 12:00:00 -0400]}
</code></pre>

<p>The <code>chunk</code> method is similar to <code>group_by</code> as it will divide the collection
into groups based on the given block/proc except it returns an enumerator
instead of a hash:</p>

<pre><code class="ruby">r.take(10).chunk(&amp;:month)
=&gt; #&lt;Enumerator: ...&gt;
</code></pre>

<p>I recently <a href="/blog/what-is-enumerator.html">described some great things you can do with enumerators in Ruby</a> including transforming the result of chunk into an array of month, time pairs:</p>

<pre><code class="ruby">r.take(10).chunk(&amp;:month).to_a
=&gt; [[2, [2016-02-02 12:00:00 -0500, 2016-02-16 12:00:00 -0500]],
 [3, [2016-03-01 12:00:00 -0500, 2016-03-15 12:00:00 -0400, 2016-03-29 12:00:00 -0400]],
 [4, [2016-04-12 12:00:00 -0400, 2016-04-26 12:00:00 -0400]],
 [5, [2016-05-10 12:00:00 -0400, 2016-05-24 12:00:00 -0400]],
 [6, [2016-06-07 12:00:00 -0400]]]
</code></pre>

<p>Interestingly enough, passing the previous result to <code>Hash[]</code> returns the same
result we got with <code>group_by</code>:</p>

<pre><code class="ruby">Hash[r.take(10).chunk(&amp;:month).to_a]
=&gt; {2=&gt;[2016-02-02 12:00:00 -0500, 2016-02-16 12:00:00 -0500],
 3=&gt;[2016-03-01 12:00:00 -0500, 2016-03-15 12:00:00 -0400, 2016-03-29 12:00:00 -0400],
 4=&gt;[2016-04-12 12:00:00 -0400, 2016-04-26 12:00:00 -0400],
 5=&gt;[2016-05-10 12:00:00 -0400, 2016-05-24 12:00:00 -0400],
 6=&gt;[2016-06-07 12:00:00 -0400]}
</code></pre>

<p>If we just wanted the groups of times, not the month keys, we could ask for the
<code>group_by</code> values:</p>

<pre><code class="ruby">r.take(10).group_by(&amp;:month).values
=&gt; [[2016-02-02 12:00:00 -0500, 2016-02-16 12:00:00 -0500],
 [2016-03-01 12:00:00 -0500, 2016-03-15 12:00:00 -0400, 2016-03-29 12:00:00 -0400],
 [2016-04-12 12:00:00 -0400, 2016-04-26 12:00:00 -0400],
 [2016-05-10 12:00:00 -0400, 2016-05-24 12:00:00 -0400],
 [2016-06-07 12:00:00 -0400]]
</code></pre>

<p>We can replace this computation with <code>slice_when</code> which will allow us to compare
adjacent members to determine &ldquo;when&rdquo; to start a new slice (or chunk). That means
the block we pass to <code>slice_when</code> accepts two arguments, the current and
previous collection member, and should return true or false. In this
case, we want a new slice to start when the month of the previous time does not
match the month of the current time as we enumerate:</p>

<pre><code class="ruby">r.take(10).slice_when { |a, b| a.month != b.month }.to_a
=&gt; [[2016-02-02 12:00:00 -0500, 2016-02-16 12:00:00 -0500],
 [2016-03-01 12:00:00 -0500, 2016-03-15 12:00:00 -0400, 2016-03-29 12:00:00 -0400],
 [2016-04-12 12:00:00 -0400, 2016-04-26 12:00:00 -0400],
 [2016-05-10 12:00:00 -0400, 2016-05-24 12:00:00 -0400],
 [2016-06-07 12:00:00 -0400]]
</code></pre>

<p>Note the return value of <code>slice_when</code> is an enumerator like we saw with <code>chunk</code>.</p>

<p>It turns out, the most common use cases of <code>slice_when</code> tend to be negative
comparisons, i.e., &ldquo;slice when the previous thing is not the same as the current
thing&rdquo;. Since this is Ruby after all, wouldn&rsquo;t you prefer to stay positive?</p>

<p>Which brings us to <code>chunk_while</code>. Ruby 2.3 introduces this positive complement to
<code>slice_when</code> so we can say, &ldquo;keep the same chunk if the current thing <em>does</em>
match the previous thing&rdquo;.</p>

<p>Back to our Tuesday recurrences. Let&rsquo;s replace <code>slice_when</code> with <code>chunk_while</code>:</p>

<pre><code class="ruby">r.take(10).chunk_while { |a, b| a.month == b.month }.to_a
=&gt; [[2016-02-02 12:00:00 -0500, 2016-02-16 12:00:00 -0500],
 [2016-03-01 12:00:00 -0500, 2016-03-15 12:00:00 -0400, 2016-03-29 12:00:00 -0400],
 [2016-04-12 12:00:00 -0400, 2016-04-26 12:00:00 -0400],
 [2016-05-10 12:00:00 -0400, 2016-05-24 12:00:00 -0400],
 [2016-06-07 12:00:00 -0400]]
</code></pre>

<p>So in short, <code>Enumerable</code> in Ruby 2.3 gives us both a negative and a positive variation, <code>grep_v</code> and <code>chunk_while</code> respectively, on existing methods.</p>

<hr>

<p>Looking for a way to handle recurring events in your app? Be sure to check out <a href="https://github.com/rossta/montrose">Montrose</a>.</p>


    </article>
    <hr />
    <section class="margin-bottom double">
      <p>
        Did you like this post? Do me a favor: <a target="_blank" href="https://twitter.com/intent/tweet?text=What%27s%20new%20in%20Ruby%202.3%20Enumerable%20-%20rossta.net&amp;url=rossta.net%3A4567%2Fblog%2Fwhats-new-in-ruby-2-3-enumerable.html">share it on Twitter</a>,
          <a href="https://twitter.com/rossta">follow me - @rossta</a>,
          and sign up for my newsletter. Thanks!
        </p>
      </section>
    </section>
    <section class="signup-form-standalone margin-bottom double">
      <!-- Begin MailChimp Signup Form -->
<div class="signup-form">
  <h3>LEVEL UP your web development</h3>
  <p>Sign up for my occasional newsletter on professional Ruby and Javascript for the web.</p>
  <div id="mc_embed_signup">
    <form action="//rossta.us6.list-manage.com/subscribe/post?u=8ce159842b5c98cecb4ebdf16&amp;id=96030b0bda" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
      <div id="mc_embed_signup_scroll">

        <div class="row">
          <div class="large-10 columns">
            <div class="row collapse">
              <div class="large-8 small-7 columns">
                <input type="email" placeholder="Your email..." value="" name="EMAIL" class="required email" id="mce-EMAIL">
              </div>
              <div class="large-4 small-5 columns">
                <input type="submit" value="Sign me up!" name="subscribe" id="mc-embedded-subscribe" class="button postfix">
              </div>
            </div>
          </div>
        </div>

        <div id="mce-responses" class="clear">
          <div class="response" id="mce-error-response" style="display:none"></div>
          <div class="response" id="mce-success-response" style="display:none"></div>
        </div>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;"><input type="text" name="b_8ce159842b5c98cecb4ebdf16_96030b0bda" tabindex="-1" value=""></div>
      </div>

      <input type="hidden" name="SIGNUP_LOCATION" id="signup_location" value="blog/2016-01-18-whats-new-in-ruby-2-3-enumerable.html" />
      <input type="hidden" name="SIGNUP_TAGS" id="signup_tags" value="Ruby" />
    </form>
  </div>

  <!--End mc_embed_signup-->
</div>

    </section>
    <section class="margin-bottom double">
      <p>
          Part of the <a href="/blog/series/enumerable.html">Enumerable</a> series.
        Published on Jan 18, 2016
    </p>
  </section>
    <hr />
    <section class="comments">
      <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname  = "rosskaff";
    var disqus_identifier = "whats-new-in-ruby-2-3-enumerable";
    var disqus_title      = "What's new in Ruby 2.3 Enumerable";
    var disqus_url        = "https://rossta.net/blog/whats-new-in-ruby-2-3-enumerable.html";

    var disqus_config = function () {
        this.page.url = disqus_url;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = disqus_identifier; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        this.page.title = disqus_title;
    };

    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//rosskaff.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<!-- <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a> -->

    </section>

      </section>
    </div>
    
    <footer>
  <div class="row">
    <img class="turtle" src="/assets/images/turtle-logo-096698b6.svg" />
    <section class="large-6 columns">
      <h5>Most Popular</h5>
      <ul>
          <li><a href="/blog/how-to-specify-local-ruby-gems-in-your-gemfile.html">How to specify local Ruby gems in your Gemfile</a></li>
          <li><a href="/blog/web-push-notifications-from-rails.html">Sending Web Push Notifications from Rails</a></li>
          <li><a href="/blog/a-ruby-antihero-thread-pool.html">Thread Pool - A Ruby Antihero</a></li>
          <li><a href="/blog/what-i-learned-about-hanami.html">What I learned building an app in Hanami</a></li>
          <li><a href="/blog/service-worker-on-rails.html">Service Worker on Rails</a></li>
      </ul>
    </section>
    <section class="large-3 columns">
      <h5>Categories</h5>
      <ul>
          <li><a href="/blog/tags/ruby.html">Ruby</a></li>
          <li><a href="/blog/tags/rails.html">Rails</a></li>
          <li><a href="/blog/tags/javascript.html">JavaScript</a></li>
          <li><a href="/blog/tags/rspec.html">RSpec</a></li>
          <li><a href="/blog/tags/process.html">Process</a></li>
      </ul>
    </section>
    <section class="large-3 columns">
      <h5>Contact</h5>
      <ul>
        <li><a href="mailto:ross@rossta.net">email</a></li>
        <li><a href="https://twitter.com/rossta">twitter</a></li>
        <li><a href="https://github.com/rossta">github</a></li>
        <li><a href="https://stackoverflow.com/users/771838/rossta?tab=profile">stackoverflow</a></li>
        <li><a href="https://www.linkedin.com/in/rosskaffenberger">linkedin</a></li>
      </ul>
    </section>
  </div>
  <p class="copyright small subtle center">
    © 2016 Ross Kaffenberger. All rights reserved.
  </p>
</footer>

    <script src="/assets/javascripts/index.bundle-33458126.js"></script>
    
    <script type="text/javascript">
!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
analytics.load("NdBtrprkAGAjQryMShljRdVf90saElAU");
analytics.page()
window.$.tracking.flush(analytics);
}}();
</script>

  </body>
</html>
